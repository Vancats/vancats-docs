---
date created: 2022-03-06 15:02
date updated: 2022-03-06 21:58
---

### 浏览器安全

#### XSS 攻击

**恶意操作**

- 获取页面数据，cookie，localStorage
- DOS攻击，发送合理请求，占用服务器资源
- 破坏页面结构
- 流量劫持，将链接指向其他网站

**攻击类型**

- 存储型：存储在服务器上，用户请求时返回并执行
- 反射型：诱导用户访问一个带有恶意代码的URL，服务器端接受处理后，把带有恶意代码的数据发送到浏览器端，浏览器解析后当作正常脚本执行，实现XSS攻击
- DOM型：通过修改页面的DOM节点

**攻击步骤**

- 存储型：论坛发帖、商品评论、用户私信等需要保存数据的网站
	1. 攻击者提交恶意代码到目标网站数据库
	2. 用户打开网站时，服务器取出恶意代码拼接成HTML返回给浏览器
	3. 浏览器解析
	4. 恶意代码窃取用户信息并发送到攻击者网站，或冒充用户行为执行指定操作（_XSS 统一操作_）

- 反射型：网站搜索，跳转等通过URL传参的功能；和存储型的区别是一个存在数据库，一个在URL中
	1. 攻击者构造包含恶意代码的URL
	2. 用户打开URL，服务器取出URL中的恶意代码拼接成HTML返回给浏览器
	3. 浏览器解析
	4. XSS 统一操作

- DOM型：这种是前端 JS 自身漏洞，其他两种都是服务端的漏洞
	1. 攻击者构造包含恶意代码的URL
	2. 用户打开该URL
	3. 用户浏览器接收到响应后解析，JS 取出 URL 的恶意代码并执行
	4. XSS 统一操作

**如何防御**

1. 纯前端方式，不实用服务端拼接返回内容（服务端渲染）
2. 对需要插入到 HTML 中的代码做好充分转义，如 script 标签等
3. 保护敏感信息，对 cookie 使用 http-only
4. 使用验证码，避免脚本伪装成用户操作
5. 使用 CSP，建立白名单，告知浏览器可执行的资源；可以设置 Content-Security-Policy 或者 meta 标签

#### CSRF 攻击

跨站请求伪造攻击，诱导用户进入第三方网站，该网站发送跨站请求，如果用户保留了登陆状态，就可以绕过后台验证执行操作

**本质**：cookie 会在同源请求中携带发送给服务器

**攻击类型**
- GET类型：在网站的 img 标签中添加请求，打开网站自动提交
- POST类型：构建隐藏的表单，打开网站自动提交
- 链接类型：a 标签的 href 属性，诱导用户点击

**如何防御**
- 同源检测
	- 服务器根据 http 请求头中的 origin 或 referer 判断请求是否为允许的站点来过滤，两者都不存在时，直接阻止请求
	- 一般网站会允许搜索引擎的页面请求，这种请求也同时可能被攻击
	- 缺点：referer 可以被伪造，还会屏蔽搜索引擎链接
	- referer 告知服务器该网页从哪个页面链接而来
- CSRF Token 验证
	- 服务器返回 token，用户请求带入 token，服务器验证
	- 解决 cookie 单一验证被冒用问题
	- 缺点：需要给所有请求都加上 token；如果请求经过负载平衡转移到其他服务器，而它的 session 中没有该 token，将无法验证
	- 上述缺点可以通过改变 token 的构建方式来解决
- 对 Cookie 进行双重验证
	- 
- 设置 Cookie 的时候设置 SameSit，限制其不能被第三方使用
	- 严格模式：任何情况都不能被第三方使用
	- 宽松模式：GET请求且会发送页面跳转的请求使用


#### 中间人攻击
攻击者与通讯两端分别建立独立的联系，并交换其数据，通讯两端认为他们在私密对话，实际全程被监控。攻击者可以拦截通讯并插入新的内容。

**攻击过程**
1. 客户端发送请求到服务端，被截获
2. 服务端向客户端发送公钥，中间人截获，生成伪造公钥，发给客户端
3. 客户端收到伪造公钥，发送生成加密的 hash
4. 中间人截获，用自身私钥解密获得真秘钥，生成假的加密 hash 值发给服务器
5. 服务器用私钥解密获得假密钥，加密数据传给客户端

#### 前端安全问题
1. 跨站脚本 - XSS
2. 跨站点请求伪造 - CSRF
3. iframe 的滥用：iframe 由第三方提供，默认情况不受控制，可以运行脚本，Flash 插件，弹出对话框等
4. 恶意第三方库：第三方库被植入恶意代码

#### 网络劫持
1. DNS劫持
  - 例子：输入京东被强制跳转淘宝，犯法，使用较少
  - DNS强制解析：修改运营商本地DNS记录，引导用户流量到缓存服务器
  - 302 跳转的方式：通过监控网络出口的流量，分析可劫持的内容，发起 302 的跳转的回复，引导用户获取内容
2. HTTP劫持
  - 例子：访问谷歌但是一直有贪玩蓝月的广告
  - 由于HTTP明文传输，运营商可以改变响应内容，加广告
  - 解决方案：全站使用HTTPS
