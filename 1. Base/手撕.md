---
date created: 2022-05-16 16:27
date updated: 2022-05-17 19:03
---

### 8. 懒加载

```javascript
let img = document.querySelectorAll('img')
// 可视区高度
let clientHeight = window.innerHeight || document.documentElement.clientHeight ||document.body.clientHeight
function lazyLoad(){
    let scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
    for(let i = 0; i < imgs.length; i++){
		// 图片在可视区冒出的高度
        let x = clientHeight + scrollTop - imgs[i].offsetTop
        // 图片在可视区内
        if(x > 0 && x < clientHeight + imgs[i].height) {
            imgs[i].src = imgs[i].getAttribute('data')
        }
    }
}
addEventListener('scroll', lazyLoad) // setInterval(lazyLoad, 1000)
```

### 18. 实现 filter

```javascript
function selfFilter(fn, context) {
    if(typeof fn !== 'function') { throw new TypeError(`${fn} is not a function`)}
    let arr = this, temp = []
    for(let i = 0; i < arr.length; i++) {
        let result = fn.call(context, arr[i], i, arr)
        if(result) temp.push(arr[i])
    }
    return temp
}
Array.prototype.selfFilter = selfFilter
```

### 19. 实现 map

```javascript
const selfMap = function(fn, context) {
    let arr = Array.prototype.slice.call(this)
    let mappedArr = []
    for(let i = 0; i < arr.length; i++) {
        // 判断稀疏数组
        if(!arr.hasOwnProperty(i)) continue
        mappedArr[i] = fn.call(context, arr[i], i, this)
    }
    return mappedArr
}
const selfMap = function(fn, context) {
    let arr = Array.prototype.slice.call(this)
    return arr.reduce((pre, cur, index) => {
        return [...pre, fn.call(context, cur, index, this)]
    }, [])
}
Array.prototype.selfMap = selfMap
```

### 21. 实现 Reduce

```javascript
Array.prototype.selfReduce = function(cb, initialValue) {
    const array = this
    let acc = initialValue || array[0]
    const startIndex = initialValue ? 0: 1
    for(let i = startIndex; i < array.length; i++) {
        const cur = array[i]
        // 上一次的返回值 prev 当前值 cur 索引 index 数组对象 array
        acc = cb(acc, cur, i, array)
    }
    return acc
}
```

